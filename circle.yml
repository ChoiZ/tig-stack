---

machine:
  services:
    - docker
  environment:
    PORTS: "3001 8083 8086"

dependencies:
  override:
    - docker info

test:
  pre:
    - docker-compose -f docker-compose-circleci.yml up -d
    - docker ps
    - docker-compose logs; sleep 3
  override:
    - for port in $PORTS; do curl --retry 10 --retry-delay 5 -v http://localhost:${port}; done
  post:
    - for port in $PORTS; do curl -OL http://localhost:${port}; done
    - mv *.html $CIRCLE_ARTIFACTS
    - killall --wait docker
